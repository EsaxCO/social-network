(this.webpackJsonplesson=this.webpackJsonplesson||[]).push([[4],{300:function(e,t,a){},301:function(e,t,a){},302:function(e,t,a){},303:function(e,t,a){},310:function(e,t,a){},327:function(e,t,a){"use strict";a.r(t);var n=a(5),s=a.n(n),c=a(11),r=a(71),o=a(0),i=a.n(o),l=(a(300),a(301),a(302),a(10)),u=function(e){var t=e.id,a=e.name,n=e.count,s=e.status;return i.a.createElement("li",{className:"section-dialogs-inner-members-li"},i.a.createElement(l.c,{className:"section-dialogs-inner-members-li-url",to:"/home/dialogs/"+t},a,s?i.a.createElement("div",{className:"new-message"},"\u041d\u043e\u0432\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439: ",n):null))},m=a(22),d=a.n(m),g=a(299),b={count:0};function f(e,t){switch(t.type){case"set":return{count:t.number};default:throw new Error}}var v=function(e){var t=e.instance,a=Object(o.useReducer)(f,b),n=Object(r.a)(a,2),l=(n[0],n[1]),m=Object(o.useState)([]),v=Object(r.a)(m,2),p=v[0],E=v[1],k=Object(o.useCallback)((function(e){l({type:"set",number:e})})),j=d.a.CancelToken.source(),O=function(){var e=Object(c.a)(s.a.mark((function e(){var a,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.get("/dialogs",{cancelToken:j.token});case 3:return a=e.sent,e.next=6,t.get("/dialogs/messages/new/count",{cancelToken:j.token});case 6:200===(n=e.sent).status&&k(n.data),200===a.status&&(g.isEqual(p,a.data)||E(a.data)),e.next=18;break;case 11:if(e.prev=11,e.t0=e.catch(0),!d.a.isCancel(e.t0)){e.next=17;break}console.log("cancel request Members"),e.next=18;break;case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}();Object(o.useEffect)((function(){var e=!0;return e&&setInterval((function(){O()}),1e4),O(),function(){e=!1,j.cancel()}}),[p]);var h=p.map((function(e){return i.a.createElement(u,{status:e.hasNewMessages,count:e.newMessagesCount,key:e.id,id:e.id,name:e.userName})}));return i.a.createElement("ul",{className:"section-dialogs-inner-members"},h)},p=a(17),E=a(62),k=(a(303),a(304)),j=a(95),O=a.n(j),h=a(53),N=function(e){var t=e.total,a=e.userAvatar,n=e.avatar,s=e.restoreMessage,c=e.deleteMessage,l=e.setPageCurrent,u=e.id,m=e.currentPage,d=e.mainMessageData,g=Object(o.useState)([]),b=Object(r.a)(g,2),f=b[0],v=b[1],E=function(e){s(e);var t=f.map((function(t){if(t!==e)return t}));v(t)},j=function(e){c(e);var t=[].concat(Object(p.a)(f),[e]);v(t)},N=function(e,t){l(e)},w={backgroundColor:"rgb(7, 2, 91)",color:"#ffffff",textTransform:"uppercase"},x={backgroundColor:"#07025b",fontWeight:"700",color:"#ffffff"};function y(e){var t=e.split("T"),a=t[1].split(":");return t[0]+" "+a[0]+":"+a[1]}return i.a.createElement(i.a.Fragment,null,i.a.createElement(k.a,{key:"page"+t+m,className:"pagination-style",total:t,limit:10,pageCount:10,currentPage:m},(function(e){var a=e.pages,n=e.currentPage,s=e.hasNextPage,c=e.hasPreviousPage,r=e.previousPage,o=e.nextPage,l=e.totalPages,u=e.getPageItemProps;return i.a.createElement("div",null,i.a.createElement("button",Object.assign({key:"first"+t+n},u({pageValue:1,style:w,onPageChange:N})),"first"),c&&i.a.createElement("button",Object.assign({key:"prev"+t+n},u({pageValue:r,style:x,onPageChange:N})),"<"),a.map((function(e){var a=null;return n===e?(a={backgroundColor:"#ff4067"},i.a.createElement("button",Object.assign({key:"active"+e+t+n},u({pageValue:e,style:a,onPageChange:N})),e)):i.a.createElement("button",Object.assign({key:e+t+n},u({pageValue:e,style:a,onPageChange:N})),e)})),s&&i.a.createElement("button",Object.assign({key:"next"+t+n},u({pageValue:o,style:x,onPageChange:N})),">"),i.a.createElement("button",Object.assign({key:"last"+t+n},u({pageValue:l,style:w,onPageChange:N})),"last"))})),i.a.createElement("div",{className:"row"},0!==d?d.map((function(e){if(e.id===m)return i.a.createElement("ul",{key:e.id+t+m},e.item.map((function(e){return e.recipientId===u?i.a.createElement("div",{key:e.id}," ",i.a.createElement("div",{className:"section-dialogs-inner-active-message col-sm-6 col-sm-offset-6"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"content-message"},i.a.createElement("div",{className:"col-sm-4 content-message-avatar"},i.a.createElement("img",{className:"img-responsive rounded-circle",src:n||O.a,alt:""}),f.includes(e.id)?i.a.createElement("button",{onClick:function(){E(e.id)},className:"content-message-button-restore"},"restore"):i.a.createElement("button",{onClick:function(){j(e.id)},className:"content-message-button-delete"},"delete")),i.a.createElement("div",{className:"col-sm-8 content-message-text"},i.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},i.a.createElement("h5",null,e.senderName),i.a.createElement("h6",null,y(e.addedAt))),i.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},i.a.createElement("div",{className:"wrapword"},e.body)))))),i.a.createElement("div",{className:"col-sm-12 nopadding"},e.viewed?i.a.createElement("div",{className:"message-paddding-viewed"}):i.a.createElement("div",{className:"viewed-status"},"\u041d\u0435 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"))):i.a.createElement("div",{key:e.id},i.a.createElement("div",{key:e.id,className:"section-dialogs-inner-active-message col-sm-6"},i.a.createElement("div",{className:"row"},i.a.createElement("div",{className:"content-message"},i.a.createElement("div",{className:"col-sm-4 content-message-avatar"},i.a.createElement("img",{className:"img-responsive rounded-circle",src:a||O.a,alt:""}),f.includes(e.id)?i.a.createElement("button",{onClick:function(){E(e.id)},className:"content-message-button-restore"},"restore"):i.a.createElement("button",{onClick:function(){j(e.id)},className:"content-message-button-delete"},"delete")),i.a.createElement("div",{className:"col-sm-8 col-centered content-message-text"},i.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},i.a.createElement("h5",null,e.senderName),i.a.createElement("h6",null,y(e.addedAt))),i.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},i.a.createElement("p",{className:"wrapword"},e.body)))))),i.a.createElement("div",{className:"col-sm-12 nopadding"},i.a.createElement("div",{className:"message-paddding-viewed"})))})))})):i.a.createElement(h.a,{isLoading:!0})))},w=a(34),x=(a(310),a(128)),y=a(129),C=Object(y.a)({form:"SendMessageFormn"})((function(e){var t=e.handleSubmit;return i.a.createElement("form",{onSubmit:t,name:"SendMessage"},i.a.createElement("div",{className:"section-dialogs-inner-newmessage"},i.a.createElement(x.a,{name:"message",component:"textarea",className:"section-dialogs-inner-newmessage-input",id:"",rows:"2"}),i.a.createElement("button",{className:"section-dialogs-inner-newmessage-button"},"Send Message")))})),P=function(e){var t=e.onSubmit;return i.a.createElement(C,{onSubmit:t})},S=a(299),M=function(e){var t=e.id,a=e.avatar,n=e.instance,l=e.userAvatar,u=Object(o.useState)(!1),m=Object(r.a)(u,2),g=m[0],b=m[1],f=Object(o.useState)([]),v=Object(r.a)(f,2),k=v[0],j=v[1],O=Object(o.useState)(!1),w=Object(r.a)(O,2),x=w[0],y=w[1],C=Object(o.useState)(!1),M=Object(r.a)(C,2),T=M[0],A=M[1],L=Object(o.useState)(0),q=Object(r.a)(L,2),V=q[0],I=q[1],D=Object(o.useState)(1),F=Object(r.a)(D,2),J=F[0],R=F[1],U=Object(o.useState)(!1),G=Object(r.a)(U,2),K=G[0],W=G[1],Y=Object(o.useState)(!1),z=Object(r.a)(Y,2),B=z[0],H=z[1],Q=Object(o.useState)(!1),X=Object(r.a)(Q,2),Z=X[0],$=X[1],_=d.a.CancelToken.source(),ee=function(){var e=Object(c.a)(s.a.mark((function e(){var a,c,r,o,i,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.get("/dialogs/".concat(t,"/messages?page=").concat(J,"&count=10"),{cancelToken:_.token});case 3:200===(a=e.sent).status&&(!1===g?(c=[{id:1,item:a.data.items}],j(c),I(a.data.totalCount),b(!0)):(I(a.data.totalCount),r=k.reduce((function(e,t){return Object.assign(e,Object(E.a)({},t.id,t.item))}),{}),J>1?k.length>1&&!0===T?S.isEqual(a.data.items,r[J])||(o=[].concat(Object(p.a)(k),[k[J-1]=[J,a.data.items]]),j(o)):(i=[].concat(Object(p.a)(k),[{id:J,item:a.data.items}]),j(i),A(!0)):S.isEqual(a.data.items,r[J])?console.log("SAME PAGE"):(l=[{id:1,item:a.data.items}],j(l),console.log("STATE UPDATE")))),e.next=18;break;case 7:if(e.prev=7,e.t0=e.catch(0),!d.a.isCancel(e.t0)){e.next=13;break}console.log("cancel request Messages"),e.next=18;break;case 13:if(void 0!==e.t0){e.next=17;break}console.log("some response error"),e.next=18;break;case 17:throw e.t0;case 18:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),te=Object(o.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(a){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a.message,!x){e.next=3;break}return e.abrupt("return");case 3:return y(!0),e.next=6,n.post("/dialogs/".concat(t,"/messages"),{body:c,cancelToken:_.token});case 6:R(J),W(!K),y(!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[x,n]),ae=Object(o.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Z){e.next=2;break}return e.abrupt("return");case 2:return $(!0),e.next=5,n.put("/dialogs/messages/".concat(t,"/restore"),{cancelToken:_.token});case 5:$(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Z,n]),ne=Object(o.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!B){e.next=2;break}return e.abrupt("return");case 2:return H(!0),e.next=5,n.delete("/dialogs/messages/".concat(t),{cancelToken:_.token});case 5:H(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[B]);return Object(o.useEffect)((function(){var e=!0;return e&&setInterval((function(){ee()}),1e4),ee(),function(){e=!1,_.cancel()}}),[K,J,k]),!1===g?i.a.createElement("div",{className:"MessagesLoader"},i.a.createElement(h.a,{isLoading:!0})):i.a.createElement("div",{key:"section-dialogs-inner-active",className:"section-dialogs-inner-active"},i.a.createElement(N,{userAvatar:l,avatar:a,id:t,restoreMessage:ae,setPageCurrent:function(e){R(e)},currentPage:J,deleteMessage:ne,mainMessageData:k,total:V}),i.a.createElement(P,{onSubmit:te}))},T=function(e){var t=e.membersList,a=e.instance,n=e.profile;if(null===t||null===n)return i.a.createElement("div",{className:"MessagesLoader"},i.a.createElement(h.a,{isLoading:!0}));var s=t.map((function(e){return i.a.createElement(w.b,{key:e.id,path:"/home/dialogs/".concat(e.id),render:function(){return i.a.createElement(M,{instance:a,key:e.id,userAvatar:e.photos.small,avatar:n.photos.small,id:e.id})}})}));return i.a.createElement(i.a.Fragment,null,i.a.createElement("div",{className:"section-dialogs-inner-active"},s))},A=a(14),L=m.create({withCredentials:!0,headers:{"API-KEY":"9832db98-b9d3-460c-9cab-5d06ff193b07"},baseURL:"https://social-network.samuraijs.com/api/1.0/"});t.default=function(){var e=Object(o.useState)([]),t=Object(r.a)(e,2),a=t[0],n=t[1],u=Object(o.useState)(null),m=Object(r.a)(u,2),g=m[0],b=m[1],f=Object(A.c)((function(e){return e.authPage.id}));return Object(o.useEffect)((function(){var e=d.a.CancelToken.source();return function(){var t=Object(c.a)(s.a.mark((function t(){var a,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,L.get("/dialogs",{cancelToken:e.token});case 3:return a=t.sent,t.next=6,L.get("/profile/".concat(f),{cancelToken:e.token});case 6:c=t.sent,200===a.status&&n(a.data),200===c.status&&b(c.data),t.next=18;break;case 11:if(t.prev=11,t.t0=t.catch(0),!d.a.isCancel(t.t0)){t.next=17;break}console.log("cancel request Dialogs"),t.next=18;break;case 17:throw t.t0;case 18:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(){return t.apply(this,arguments)}}()(),function(){e.cancel()}}),[]),i.a.createElement(l.a,null,i.a.createElement("div",{className:"section-dialogs"},i.a.createElement("div",{className:"section-dialogs-inner"},i.a.createElement("div",{className:"col-sm-4"},i.a.createElement(v,{members:a,instance:L})),i.a.createElement(T,{profile:g,instance:L,membersList:a}))))}}}]);
//# sourceMappingURL=4.c92de7cb.chunk.js.map