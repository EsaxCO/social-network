(this.webpackJsonplesson=this.webpackJsonplesson||[]).push([[4],{301:function(e,t,a){},302:function(e,t,a){},303:function(e,t,a){},304:function(e,t,a){},312:function(e,t,a){},329:function(e,t,a){"use strict";a.r(t);var n=a(5),s=a.n(n),c=a(10),r=a(91),l=a(0),o=a.n(l),i=(a(301),a(302),a(303),a(11)),u=function(e){var t=e.id,a=e.name,n=e.count,s=e.status;return o.a.createElement("li",{className:"section-dialogs-inner-members-li"},o.a.createElement(i.c,{className:"section-dialogs-inner-members-li-url",to:"/home/dialogs/"+t},a,s?o.a.createElement("div",{className:"new-message"},"\u041d\u043e\u0432\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439: ",n):null))},m=a(19),d=a.n(m),g=a(299),f={count:0};function b(e,t){switch(t.type){case"set":return{count:t.number};default:throw new Error}}var v=function(e){var t=e.instance,a=d.a.CancelToken.source(),n=Object(l.useReducer)(b,f),i=Object(r.a)(n,2),m=(i[0],i[1]),v=Object(l.useState)([]),p=Object(r.a)(v,2),E=p[0],k=p[1],j=Object(l.useCallback)((function(e){m({type:"set",number:e})}),[]);Object(l.useEffect)((function(){var e=function(){var e=Object(c.a)(s.a.mark((function e(){var n,c,r,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.get("/dialogs",{cancelToken:a.token});case 3:return n=e.sent,e.next=6,t.get("/dialogs/messages/new/count",{cancelToken:a.token});case 6:return c=e.sent,r=[n,c],e.next=10,Promise.allSettled(r);case 10:200===(l=e.sent)[1].value.status&&(c===l[1].value.data?j(l[1].value.data):console.log("same Members-count data")),200===l[0].value.status&&(g.isEqual(E,l[0].value.data)?console.log("same Members data"):k(l[0].value.data)),e.next=22;break;case 15:if(e.prev=15,e.t0=e.catch(0),!d.a.isCancel(e.t0)){e.next=21;break}console.log("cancel request Members"),e.next=22;break;case 21:throw e.t0;case 22:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),n=setInterval((function(){e()}),1e4);return e(),function(){clearInterval(n),a.cancel()}}),[E,t,j]);var O=E.map((function(e){return o.a.createElement(u,{status:e.hasNewMessages,count:e.newMessagesCount,key:e.id,id:e.id,name:e.userName})}));return o.a.createElement("ul",{className:"section-dialogs-inner-members"},O)},p=(a(304),a(17)),E=a(305),k=a(94),j=a.n(k),O=a(54),N=a(299),h=function(e){var t=e.total,a=e.userAvatar,n=e.avatar,s=e.restoreMessage,c=e.deleteMessage,i=e.setPageCurrent,u=e.id,m=e.currentPage,d=e.mainMessageData,g=Object(l.useState)([]),f=Object(r.a)(g,2),b=f[0],v=f[1],k=Object(l.useState)(!0),h=Object(r.a)(k,2),w=h[0],x=h[1],y=Object(l.useState)({}),C=Object(r.a)(y,2),P=(C[0],C[1]),S=function(e){s(e);var t=b.map((function(t){return t!==e?t:null}));v(t)},M=function(e){c(e);var t=[].concat(Object(p.a)(b),[e]);v(t)},T=function(e,t){i(e),x(!1)};Object(l.useEffect)((function(){return x(!0),P(d),function(){}}),[d]);var I={backgroundColor:"rgb(7, 2, 91)",color:"#ffffff",textTransform:"uppercase"},L={backgroundColor:"#07025b",fontWeight:"700",color:"#ffffff"};function A(e){var t=e.split("T"),a=t[1].split(":");return t[0]+" "+a[0]+":"+a[1]}return o.a.createElement(o.a.Fragment,null,o.a.createElement(E.a,{key:"page"+t+m,className:"pagination-style",total:t,limit:10,pageCount:10,currentPage:m},(function(e){var a=e.pages,n=e.currentPage,s=e.hasNextPage,c=e.hasPreviousPage,r=e.previousPage,l=e.nextPage,i=e.totalPages,u=e.getPageItemProps;return o.a.createElement("div",null,o.a.createElement("button",Object.assign({key:"first"+t+n},u({pageValue:1,style:I,onPageChange:T})),"first"),c&&o.a.createElement("button",Object.assign({key:"prev"+t+n},u({pageValue:r,style:L,onPageChange:T})),"<"),a.map((function(e){var a=null;return n===e?(a={backgroundColor:"#ff4067"},o.a.createElement("button",Object.assign({key:"active"+e+t+n},u({pageValue:e,style:a,onPageChange:T})),e)):o.a.createElement("button",Object.assign({key:e+t+n},u({pageValue:e,style:a,onPageChange:T})),e)})),s&&o.a.createElement("button",Object.assign({key:"next"+t+n},u({pageValue:l,style:L,onPageChange:T})),">"),o.a.createElement("button",Object.assign({key:"last"+t+n},u({pageValue:i,style:I,onPageChange:T})),"last"))})),o.a.createElement("div",{className:"row"},!N.isEmpty(d)&&w?o.a.createElement("ul",null,d.item.map((function(e){return e.recipientId===u?o.a.createElement(l.Fragment,{key:e.id},o.a.createElement("div",{className:e.viewed?"section-dialogs-inner-active-message col-sm-6 col-sm-offset-6":"section-dialogs-inner-active-messagenew col-sm-6 col-sm-offset-6"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"content-message"},o.a.createElement("div",{className:"col-sm-4 content-message-avatar"},o.a.createElement("img",{className:"img-responsive rounded-circle",src:n||j.a,alt:""}),b.includes(e.id)?o.a.createElement("button",{onClick:function(){S(e.id)},className:"content-message-button-restore"},"restore"):o.a.createElement("button",{onClick:function(){M(e.id)},className:"content-message-button-delete"},"delete")),o.a.createElement("div",{className:"col-sm-8 content-message-text"},o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("h5",null,e.senderName),o.a.createElement("h6",null,A(e.addedAt))),o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("div",{className:"wrapword"},e.body)))))),o.a.createElement("div",{className:"col-sm-12 nopadding"},e.viewed?o.a.createElement("div",{className:"message-paddding-viewed"}):o.a.createElement("div",{className:"viewed-status"},"\u041d\u0435 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"))):o.a.createElement(l.Fragment,{key:e.id},o.a.createElement("div",{className:"section-dialogs-inner-active-message col-sm-6"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"content-message"},o.a.createElement("div",{className:"col-sm-4 content-message-avatar"},o.a.createElement("img",{className:"img-responsive rounded-circle",src:a||j.a,alt:""}),b.includes(e.id)?o.a.createElement("button",{onClick:function(){S(e.id)},className:"content-message-button-restore"},"restore"):o.a.createElement("button",{onClick:function(){M(e.id)},className:"content-message-button-delete"},"delete")),o.a.createElement("div",{className:"col-sm-8 col-centered content-message-text"},o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("h5",null,e.senderName),o.a.createElement("h6",null,A(e.addedAt))),o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("p",{className:"wrapword"},e.body)))))),o.a.createElement("div",{className:"col-sm-12 nopadding"},o.a.createElement("div",{className:"message-paddding-viewed"})))}))):o.a.createElement("div",{className:"col-sm-2 col-sm-offset-5 MessagesLoaderInner"},o.a.createElement(O.a,{isLoading:!0}))))},w=a(33),x=(a(312),a(127)),y=a(128),C=Object(y.a)({form:"SendMessageFormn"})((function(e){var t=e.handleSubmit;e.update;return o.a.createElement("form",{onSubmit:t},o.a.createElement("div",{className:"section-dialogs-inner-newmessage"},o.a.createElement(x.a,{name:"message",component:"textarea",className:"section-dialogs-inner-newmessage-input",id:"",rows:"2"}),o.a.createElement("button",{className:"section-dialogs-inner-newmessage-button"},"Send Message")))})),P=function(e){var t=e.onSubmit,a=e.userId,n=Object(l.useState)(!1),s=Object(r.a)(n,2),c=s[0],i=s[1];Object(l.useEffect)((function(){return setTimeout((function(){i(!1)}),500),function(){}}),[c]);return c?o.a.createElement("div",{className:"section-users-elements-status"},o.a.createElement(O.a,{isLoading:!0})):o.a.createElement(C,{update:c,initialValues:{message:""},onSubmit:function(e){t(e,a),i(!0)}})},S=a(299),M=function(e){var t=e.id,a=e.avatar,n=e.instance,i=e.userAvatar,u=Object(l.useState)(!1),m=Object(r.a)(u,2),g=m[0],f=m[1],b=Object(l.useState)({}),v=Object(r.a)(b,2),p=v[0],E=v[1],k=Object(l.useState)(!1),j=Object(r.a)(k,2),N=j[0],w=j[1],x=Object(l.useState)(0),y=Object(r.a)(x,2),C=y[0],M=y[1],T=Object(l.useState)(1),I=Object(r.a)(T,2),L=I[0],A=I[1],V=Object(l.useState)(!1),q=Object(r.a)(V,2),F=q[0],D=q[1],J=Object(l.useState)(!1),R=Object(r.a)(J,2),G=R[0],K=R[1],U=Object(l.useState)(!1),W=Object(r.a)(U,2),Y=W[0],z=W[1],B=d.a.CancelToken.source(),H=function(){var e=Object(c.a)(s.a.mark((function e(){var a,c,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.get("/dialogs/".concat(t,"/messages?page=").concat(L,"&count=10"),{cancelToken:B.token});case 3:200===(a=e.sent).status&&(!1===g?(c={id:1,item:a.data.items},E(c),M(a.data.totalCount),f(!0)):S.isEqual(a.data.items,p.item)?console.log("SAME PAGE"):(r={id:L,item:a.data.items},E(r))),e.next=14;break;case 7:if(e.prev=7,e.t0=e.catch(0),!d.a.isCancel(e.t0)){e.next=13;break}console.log("cancel request Messages"),e.next=14;break;case 13:throw e.t0;case 14:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),Q=Object(l.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(t,a){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!N){e.next=2;break}return e.abrupt("return");case 2:return w(!0),e.next=5,n.post("/dialogs/".concat(a,"/messages"),{body:t.message,cancelToken:B.token});case 5:D((function(e){return!e})),w(!1);case 7:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),[N,n]),X=Object(l.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Y){e.next=2;break}return e.abrupt("return");case 2:return z(!0),e.next=5,n.put("/dialogs/messages/".concat(t,"/restore"));case 5:z(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[Y,n]),Z=Object(l.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!G){e.next=2;break}return e.abrupt("return");case 2:return K(!0),e.next=5,n.delete("/dialogs/messages/".concat(t));case 5:K(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[G,n]);return Object(l.useEffect)((function(){var e=!0;if(e)var t=setInterval((function(){H()}),1e4);return H(),function(){e=!1,B.cancel(),clearInterval(t)}}),[F,L,p]),Object(l.useEffect)((function(){return function(){B.cancel()}}),[]),!1===g?o.a.createElement("div",{className:"MessagesLoader"},o.a.createElement(O.a,{isLoading:!0})):o.a.createElement("div",{key:"section-dialogs-inner-active",className:"section-dialogs-inner-active"},o.a.createElement(h,{userAvatar:i,avatar:a,id:t,restoreMessage:X,setPageCurrent:function(e){A(e)},currentPage:L,deleteMessage:Z,mainMessageData:p,total:C}),o.a.createElement(P,{userId:t,onSubmit:Q}))},T=function(e){var t=e.membersList,a=e.instance,n=e.profile;if(null===t||null===n)return o.a.createElement("div",{className:"MessagesLoader"},o.a.createElement(O.a,{isLoading:!0}));var s=t.map((function(e){return o.a.createElement(w.b,{key:e.id,path:"/home/dialogs/".concat(e.id),render:function(){return o.a.createElement(M,{instance:a,key:e.id,userAvatar:e.photos.small,avatar:n.photos.small,id:e.id})}})}));return o.a.createElement(o.a.Fragment,null,s)},I=a(13),L=m.create({withCredentials:!0,headers:{"API-KEY":"9832db98-b9d3-460c-9cab-5d06ff193b07"},baseURL:"https://social-network.samuraijs.com/api/1.0/"});t.default=function(){var e=Object(l.useState)([]),t=Object(r.a)(e,2),a=t[0],n=t[1],u=Object(l.useState)(null),m=Object(r.a)(u,2),g=m[0],f=m[1],b=Object(I.c)((function(e){return e.authPage.id}));return Object(l.useEffect)((function(){var e=d.a.CancelToken.source();return function(){var t=Object(c.a)(s.a.mark((function t(){var a,c;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,L.get("/dialogs",{cancelToken:e.token});case 3:return a=t.sent,t.next=6,L.get("/profile/".concat(b),{cancelToken:e.token});case 6:c=t.sent,200===a.status&&n(a.data),200===c.status&&f(c.data),t.next=18;break;case 11:if(t.prev=11,t.t0=t.catch(0),!d.a.isCancel(t.t0)){t.next=17;break}console.log("cancel request Dialogs"),t.next=18;break;case 17:throw t.t0;case 18:case"end":return t.stop()}}),t,null,[[0,11]])})));return function(){return t.apply(this,arguments)}}()(),function(){e.cancel()}}),[b]),o.a.createElement(i.a,null,o.a.createElement("div",{className:"section-dialogs"},o.a.createElement("div",{className:"section-dialogs-inner"},o.a.createElement("div",{className:"col-sm-4"},o.a.createElement(v,{members:a,instance:L})),o.a.createElement(T,{profile:g,instance:L,membersList:a}))))}}}]);
//# sourceMappingURL=4.3f7a64c8.chunk.js.map