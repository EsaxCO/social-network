(this.webpackJsonplesson=this.webpackJsonplesson||[]).push([[4],{299:function(e,t,a){},300:function(e,t,a){},301:function(e,t,a){},302:function(e,t,a){},303:function(e,t,a){},327:function(e,t,a){"use strict";a.r(t);var n=a(5),s=a.n(n),c=a(11),r=a(71),i=a(0),o=a.n(i),u=(a(299),a(300),a(301),a(10)),l=function(e){var t=e.id,a=e.name,n=e.count,s=e.status;return o.a.createElement("li",{className:"section-dialogs-inner-members-li"},o.a.createElement(u.c,{className:"section-dialogs-inner-members-li-url",to:"/home/dialogs/"+t},a,s?o.a.createElement("div",{className:"new-message"},"\u041d\u043e\u0432\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439: ",n):null))},m={count:0};function d(e,t){switch(t.type){case"set":return{count:t.number};default:throw new Error}}var f=function(e){var t=e.instance,a=Object(i.useReducer)(d,m),n=Object(r.a)(a,2),u=(n[0],n[1]),f=Object(i.useState)([]),g=Object(r.a)(f,2),b=g[0],v=g[1],p=Object(i.useState)(!1),E=Object(r.a)(p,2),j=E[0],O=E[1],N=Object(i.useCallback)((function(e){u({type:"set",number:e})})),h=setTimeout((function(){O(!j)}),35e3);Object(i.useEffect)((function(){var e=function(){var e=Object(c.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/dialogs");case 2:200===(a=e.sent).status&&b!==a.data&&v(a.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return function(){var e=Object(c.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/dialogs/messages/new/count");case 2:200===(a=e.sent).status&&N(a.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),e(),function(){clearTimeout(h)}}),[j]);var w=b.map((function(e){return o.a.createElement(l,{status:e.hasNewMessages,count:e.newMessagesCount,key:e.id,id:e.id,name:e.userName})}));return o.a.createElement("ul",{className:"section-dialogs-inner-members"},w)},g=a(62),b=a(17),v=(a(302),a(95)),p=a.n(v),E=a(34),j=(a(303),a(128)),O=a(129),N=Object(O.a)({form:"SendMessageFormn"})((function(e){var t=e.handleSubmit;return o.a.createElement("form",{onSubmit:t,name:"SendMessage"},o.a.createElement("div",{className:"section-dialogs-inner-newmessage"},o.a.createElement(j.a,{name:"message",component:"textarea",className:"section-dialogs-inner-newmessage-input",id:"",rows:"2"}),o.a.createElement("button",{className:"section-dialogs-inner-newmessage-button"},"Send Message")))})),h=function(e){var t=e.onSubmit;return o.a.createElement(N,{onSubmit:t})},w=a(53),k=a(304),x=a(310),y=function(e){var t=e.total,a=e.userAvatar,n=e.avatar,s=e.restoreMessage,c=e.deleteMessage,u=e.setPageCurrent,l=e.id,m=e.currentPage,d=e.mainMessageData,f=Object(i.useState)([]),g=Object(r.a)(f,2),v=g[0],E=g[1],j=function(e){s(e);var t=v.map((function(t){if(t!==e)return t}));E(t)},O=function(e){c(e);var t=[].concat(Object(b.a)(v),[e]);E(t)},N=function(e,t){u(e)},h={backgroundColor:"rgb(7, 2, 91)",color:"#ffffff",textTransform:"uppercase"},x={backgroundColor:"#07025b",fontWeight:"700",color:"#ffffff"};function y(e){var t=e.split("T"),a=t[1].split(":");return t[0]+" "+a[0]+":"+a[1]}return o.a.createElement(o.a.Fragment,null,o.a.createElement(k.a,{className:"pagination-style",total:t,limit:10,pageCount:10,currentPage:m},(function(e){var t=e.pages,a=e.currentPage,n=e.hasNextPage,s=e.hasPreviousPage,c=e.previousPage,r=e.nextPage,i=e.totalPages,u=e.getPageItemProps;return o.a.createElement("div",null,o.a.createElement("button",u({pageValue:1,style:h,onPageChange:N}),"first"),s&&o.a.createElement("button",u({pageValue:c,style:x,onPageChange:N}),"<"),t.map((function(e){var t=null;return a===e&&(t={backgroundColor:"#ff4067"}),o.a.createElement("button",u({pageValue:e,key:e,style:t,onPageChange:N}),e)})),n&&o.a.createElement("button",u({pageValue:r,style:x,onPageChange:N}),">"),o.a.createElement("button",u({pageValue:i,style:h,onPageChange:N}),"last"))})),o.a.createElement("div",{className:"row"},0!==d?d.map((function(e){if(e.id===m)return o.a.createElement("ul",null,e.item.map((function(e){return e.recipientId===l?o.a.createElement(o.a.Fragment,null," ",o.a.createElement("div",{key:e.id,className:"section-dialogs-inner-active-message col-sm-6 col-sm-offset-6"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"content-message"},o.a.createElement("div",{className:"col-sm-4 content-message-avatar"},o.a.createElement("img",{className:"img-responsive rounded-circle",src:n||p.a,alt:""}),v.includes(e.id)?o.a.createElement("button",{onClick:function(){j(e.id)},className:"content-message-button-restore"},"restore"):o.a.createElement("button",{onClick:function(){O(e.id)},className:"content-message-button-delete"},"delete")),o.a.createElement("div",{className:"col-sm-8 content-message-text"},o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("h5",null,e.senderName),o.a.createElement("h6",null,y(e.addedAt))),o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("div",{className:"wrapword"},e.body)))))),o.a.createElement("div",{className:"col-sm-12 nopadding"},e.viewed?o.a.createElement("div",{className:"message-paddding-viewed"}):o.a.createElement("div",{className:"viewed-status"},"\u041d\u0435 \u043f\u0440\u043e\u0441\u043c\u043e\u0442\u0440\u0435\u043d\u043e"))):o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{key:e.id,className:"section-dialogs-inner-active-message col-sm-6"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"content-message"},o.a.createElement("div",{className:"col-sm-4 content-message-avatar"},o.a.createElement("img",{className:"img-responsive rounded-circle",src:a||p.a,alt:""}),v.includes(e.id)?o.a.createElement("button",{onClick:function(){j(e.id)},className:"content-message-button-restore"},"restore"):o.a.createElement("button",{onClick:function(){O(e.id)},className:"content-message-button-delete"},"delete")),o.a.createElement("div",{className:"col-sm-8 col-centered content-message-text"},o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("h5",null,e.senderName),o.a.createElement("h6",null,y(e.addedAt))),o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("p",{className:"wrapword"},e.body)))))),o.a.createElement("div",{className:"col-sm-12 nopadding"},o.a.createElement("div",{className:"message-paddding-viewed"})))})))})):o.a.createElement(w.a,{isLoading:!0})))},C=function(e){var t=e.id,a=e.avatar,n=e.instance,u=e.userAvatar,l=Object(i.useState)(!1),m=Object(r.a)(l,2),d=m[0],f=m[1],v=Object(i.useState)([]),p=Object(r.a)(v,2),E=p[0],j=p[1],O=Object(i.useState)(!1),N=Object(r.a)(O,2),k=N[0],C=N[1],S=Object(i.useState)(!1),P=Object(r.a)(S,2),M=P[0],A=P[1],L=Object(i.useState)(0),T=Object(r.a)(L,2),F=T[0],V=T[1],D=Object(i.useState)(1),I=Object(r.a)(D,2),q=I[0],J=I[1],R=Object(i.useState)(!1),U=Object(r.a)(R,2),K=U[0],W=U[1],Y=Object(i.useState)(!1),z=Object(r.a)(Y,2),B=z[0],G=z[1],H=Object(i.useState)(!1),Q=Object(r.a)(H,2),X=Q[0],Z=Q[1],$=function(){var e=Object(c.a)(s.a.mark((function e(){var a,c,r,i,o,u;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get("/dialogs/".concat(t,"/messages?page=").concat(q,"&count=10"));case 2:200===(a=e.sent).status&&(!1===d?(c=[{id:1,item:a.data.items}],j(c),V(a.data.totalCount),f(!0)):(V(a.data.totalCount),r=E.reduce((function(e,t){return Object.assign(e,Object(g.a)({},t.id,t.item))}),{}),q>1?E.length>1&&!0===M?x.isEqual(a.data.items,r[q])||(i=[].concat(Object(b.a)(E),[E[q-1]=[q,a.data.items]]),j(i)):(o=[].concat(Object(b.a)(E),[{id:q,item:a.data.items}]),j(o),A(!0)):x.isEqual(a.data.items,r)||(u=[{id:1,item:a.data.items}],j(u),A(!1),console.log("STATE UPDATE"))));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_=Object(i.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(a){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a.message,!k){e.next=3;break}return e.abrupt("return");case 3:return C(!0),e.next=6,n.post("/dialogs/".concat(t,"/messages"),{body:c});case 6:J(q),$(),C(!1);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[k]),ee=Object(i.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!X){e.next=2;break}return e.abrupt("return");case 2:return Z(!0),e.next=5,n.put("/dialogs/messages/".concat(t,"/restore"));case 5:Z(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[X]),te=Object(i.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(t){return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!B){e.next=2;break}return e.abrupt("return");case 2:return G(!0),e.next=5,n.delete("/dialogs/messages/".concat(t));case 5:G(!1);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[B]);setTimeout((function(){W(!K)}),1e4),Object(i.useEffect)((function(){return!1===d&&(f(!0),$()),function(){}}),[]);return Object(i.useEffect)((function(){return $(),function(){}}),[K,q]),!1===d?o.a.createElement("div",{className:"MessagesLoader"},o.a.createElement(w.a,{isLoading:!0})):o.a.createElement("div",{className:"section-dialogs-inner-active"},o.a.createElement(y,{userAvatar:u,avatar:a,id:t,restoreMessage:ee,setPageCurrent:function(e){J(e),A(!1),$()},currentPage:q,deleteMessage:te,mainMessageData:E,total:F}),o.a.createElement(h,{onSubmit:_}))},S=function(e){var t=e.membersList,a=e.instance,n=e.profile;if(null===t||null===n)return o.a.createElement("div",{className:"MessagesLoader"},o.a.createElement(w.a,{isLoading:!0}));var s=t.map((function(e){return o.a.createElement(E.b,{key:e.id,path:"/home/dialogs/".concat(e.id),render:function(){var t;return o.a.createElement(C,(t={avatar:e.photos.small,instance:a,key:e.id,userAvatar:e.photos.small},Object(g.a)(t,"avatar",n.photos.small),Object(g.a)(t,"id",e.id),t))}})}));return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"section-dialogs-inner-active"},s))},P=a(22),M=a(14),A=P.create({withCredentials:!0,headers:{"API-KEY":"9832db98-b9d3-460c-9cab-5d06ff193b07"},baseURL:"https://social-network.samuraijs.com/api/1.0/"});t.default=function(){var e=Object(i.useState)([]),t=Object(r.a)(e,2),a=t[0],n=t[1],l=Object(i.useState)(null),m=Object(r.a)(l,2),d=m[0],g=m[1],b=Object(M.c)((function(e){return e.authPage.id}));return Object(i.useEffect)((function(){return function(){var e=Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.get("/profile/".concat(b));case 2:200===(t=e.sent).status&&g(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),function(){}}),[]),Object(i.useEffect)((function(){return function(){var e=Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,A.get("/dialogs");case 2:200===(t=e.sent).status&&n(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),function(){n([])}}),[]),o.a.createElement(u.a,null,o.a.createElement("div",{className:"section-dialogs"},o.a.createElement("div",{className:"section-dialogs-inner"},o.a.createElement("div",{className:"col-sm-4"},o.a.createElement(f,{instance:A})),o.a.createElement(S,{profile:d,instance:A,membersList:a}))))}}}]);
//# sourceMappingURL=4.a20a76f0.chunk.js.map