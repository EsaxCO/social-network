(this.webpackJsonplesson=this.webpackJsonplesson||[]).push([[4],{299:function(e,t,a){},300:function(e,t,a){},301:function(e,t,a){},302:function(e,t,a){},303:function(e,t,a){},320:function(e,t,a){"use strict";a.r(t);var n=a(5),s=a.n(n),c=a(11),r=a(71),i=a(0),o=a.n(i),l=(a(299),a(300),a(301),a(10)),m=function(e){var t=e.id,a=e.name,n=e.count;return o.a.createElement("li",{className:"section-dialogs-inner-members-li"},o.a.createElement(l.c,{className:"section-dialogs-inner-members-li-url",to:"/home/dialogs/"+t},a,o.a.createElement("div",{className:"new-message"},"\u041d\u043e\u0432\u044b\u0445 \u0441\u043e\u043e\u0431\u0449\u0435\u043d\u0438\u0439: ",n)))},u={count:0};function d(e,t){switch(t.type){case"set":return{count:t.number};default:throw new Error}}var f=function(e){var t=e.instance,a=Object(i.useReducer)(d,u),n=Object(r.a)(a,2),l=n[0],f=n[1],v=Object(i.useState)([]),b=Object(r.a)(v,2),g=b[0],E=b[1],p=Object(i.useState)(!1),N=Object(r.a)(p,2),j=N[0],O=N[1],w=Object(i.useCallback)((function(e){f({type:"set",number:e})})),h=setTimeout((function(){O(!j)}),35e3);Object(i.useEffect)((function(){var e=function(){var e=Object(c.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/dialogs");case 2:200===(a=e.sent).status&&g!==a.data&&E(a.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return function(){var e=Object(c.a)(s.a.mark((function e(){var a;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.get("/dialogs/messages/new/count");case 2:200===(a=e.sent).status&&w(a.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),e(),function(){clearTimeout(h)}}),[j]);var k=g.map((function(e){return o.a.createElement(m,{count:l.count,key:e.id,id:e.id,name:e.userName})}));return o.a.createElement("ul",{className:"section-dialogs-inner-members"},k)},v=(a(302),a(95)),b=a.n(v),g=a(34),E=(a(303),a(128)),p=a(129),N=Object(p.a)({form:"SendMessageFormn"})((function(e){var t=e.handleSubmit;return o.a.createElement("form",{onSubmit:t,name:"SendMessage"},o.a.createElement("div",{className:"section-dialogs-inner-newmessage"},o.a.createElement(E.a,{name:"message",component:"textarea",className:"section-dialogs-inner-newmessage-input",id:"",rows:"2"}),o.a.createElement("button",{className:"section-dialogs-inner-newmessage-button"},"Send Message")))})),j=function(e){var t=e.onSubmit;return o.a.createElement(N,{onSubmit:t})},O=a(53),w=function(e){var t=e.id,a=e.avatar,n=e.instance,l=Object(i.useState)(!1),m=Object(r.a)(l,2),u=m[0],d=m[1],f=Object(i.useState)([]),v=Object(r.a)(f,2),g=v[0],E=v[1],p=Object(i.useState)(!1),N=Object(r.a)(p,2),w=N[0],h=N[1],k=Object(i.useState)(!1),S=Object(r.a)(k,2),y=S[0],x=S[1],T=function(){var e=Object(c.a)(s.a.mark((function e(){var a,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.get("/dialogs/".concat(t,"/messages"));case 2:if(200===(a=e.sent).status)if(!1===u)E(a.data.items),d(!0);else for(a.data.items.length!==g.length&&(E(a.data.items),console.log("STATE UPDATE")),c=0;c<a.data.items.length;c++)a.data.items[0].id!==g[0].id&&(E(a.data.items),console.log("STATE UPDATE"));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),L=Object(i.useCallback)(function(){var e=Object(c.a)(s.a.mark((function e(a){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=a.message,!w){e.next=3;break}return e.abrupt("return");case 3:return h(!0),e.next=6,n.post("/dialogs/".concat(t,"/messages"),{body:c});case 6:T(),h(!1);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),[w]);if(setTimeout((function(){x(!y)}),1e4),Object(i.useEffect)((function(){return!1===u&&(d(!0),T()),function(){}}),[]),Object(i.useEffect)((function(){return T(),function(){}}),[y]),!1===u)return o.a.createElement("div",{className:"MessagesLoader"},o.a.createElement(O.a,{isLoading:!0}));var A=g.map((function(e){return e.recipientId===t?o.a.createElement("div",{key:e.id,className:"section-dialogs-inner-active-message col-sm-6 col-sm-offset-6"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-sm-10 col-centered"},o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("p",{className:"wrapword"},e.body))),o.a.createElement("div",{className:"col-sm-2"},o.a.createElement("div",{className:"section-dialogs-inner-active-message-avatar"},o.a.createElement("img",{className:"rounded-circle",src:a||b.a,alt:""}))))):o.a.createElement("div",{key:e.id,className:"section-dialogs-inner-active-message col-sm-6"},o.a.createElement("div",{className:"row"},o.a.createElement("div",{className:"col-sm-2"},o.a.createElement("div",{className:"section-dialogs-inner-active-message-avatar"},o.a.createElement("img",{className:"rounded-circle",src:a||b.a,alt:""}))),o.a.createElement("div",{className:"col-sm-10"},o.a.createElement("div",{className:"section-dialogs-inner-active-message-item center-block"},o.a.createElement("p",null,e.body)))))}));return o.a.createElement("div",{className:"section-dialogs-inner-active"},A,o.a.createElement(j,{onSubmit:L}))},h=function(e){var t=e.membersList,a=e.instance;if(null===t)return o.a.createElement("div",{className:"MessagesLoader"},o.a.createElement(O.a,{isLoading:!0}));var n=t.map((function(e){return o.a.createElement(g.b,{key:e.id,path:"/home/dialogs/".concat(e.id),render:function(){return o.a.createElement(w,{instance:a,key:e.id,avatar:e.photos.small,id:e.id})}})}));return o.a.createElement(o.a.Fragment,null,o.a.createElement("div",{className:"section-dialogs-inner-active"},n))},k=a(22).create({withCredentials:!0,headers:{"API-KEY":"9832db98-b9d3-460c-9cab-5d06ff193b07"},baseURL:"https://social-network.samuraijs.com/api/1.0/"});t.default=function(){var e=Object(i.useState)([]),t=Object(r.a)(e,2),a=t[0],n=t[1];return Object(i.useEffect)((function(){return function(){var e=Object(c.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,k.get("/dialogs");case 2:200===(t=e.sent).status&&n(t.data);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()(),function(){n([])}}),[]),o.a.createElement(l.a,null,o.a.createElement("div",{className:"section-dialogs"},o.a.createElement("div",{className:"section-dialogs-inner"},o.a.createElement("div",{className:"col-sm-4"},o.a.createElement(f,{instance:k})),o.a.createElement(h,{instance:k,membersList:a}))))}}}]);
//# sourceMappingURL=4.c17b80bf.chunk.js.map